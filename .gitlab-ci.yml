image: ubuntu:rolling

pages:
  stage: deploy
  before_script:
    - apt-get install fdroidserver
    - echo $KEYSTORE | base64 -d > fdroid/keystore.p12
    - 'echo "keystorepass: $KEYSTOREPASS" >> fdroid/config.yml'
    - 'echo "keypass: $KEYSTOREPASS" >> fdroid/config.yml'
    - chmod a+x download.py
  script:
    - ./download.py
    - cd fdroid
    - fdroid update
    - rm -rf archive
    - mkdir /fdroid && fdroid server update
    - rm -rf /fdroid/archive
    - cd .. && mkdir public && mv -v /fdroid public
    - echo "Repo size:" && du -h -d 3 public
    - ls -al public/fdroid/repo/
  artifacts:
    paths:
      - public
  only:
    - master
