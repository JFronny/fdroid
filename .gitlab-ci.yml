image: ubuntu:hirsute

before_script:
  - apt update
  - DEBIAN_FRONTEND=noninteractive apt install -y wget software-properties-common fdroidserver ca-certificates
  - update-ca-certificates
  - echo "$KEYSTORE" | base64 -d > fdroid/keystore.p12
  - chmod a+x download.py
  - chmod 600 fdroid/config.yml fdroid/keystore.p12
  - mkdir -p fdroid/repo

pages:
  stage: deploy
  script:
    - ./download.py
    - cd fdroid
    - fdroid update
    - mkdir /fdroid
    - fdroid deploy
    - rm -rf /fdroid/archive
    - cd .. && mkdir public && mv -v /fdroid/* public/
  artifacts:
    paths:
      - public
    expire_in: 2 days
  only:
    - master
